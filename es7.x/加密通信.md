doc:https://www.elastic.co/guide/en/elasticsearch/reference/current/configuring-tls.html#node-certificates

## 加密HTTP客户端通信

启用安全功能后，您可以选择使用TLS确保HTTP客户端与群集之间的通信已加密。

要启用加密，您需要在集群中的每个节点上执行以下步骤
- 1.验证xpack.security.enabled设置是否true。有关更多信息，请参阅[安全设置](https://www.elastic.co/guide/en/elasticsearch/reference/7.1/security-settings.html)。
- 2.[生成私钥和X.509证书](https://www.elastic.co/guide/en/elasticsearch/reference/7.1/configuring-tls.html#node-certificates)。
- 4.将每个节点配置为：

- - 必需：[在传输层上启用TLS](https://www.elastic.co/guide/en/elasticsearch/reference/7.1/configuring-tls.html#tls-transport)。
- - 推荐：[在HTTP层启用TLS](https://www.elastic.co/guide/en/elasticsearch/reference/7.1/configuring-tls.html#tls-http)。
- 4.如果使用Active Directory用户身份验证，请 [加密Elasticsearch与Active Directory服务器之间的通信](https://www.elastic.co/guide/en/elasticsearch/reference/7.1/configuring-tls.html#tls-active-directory)。
- 5.如果您使用LDAP用户身份验证，请 [加密Elasticsearch与LDAP服务器之间的通信](https://www.elastic.co/guide/en/elasticsearch/reference/7.1/configuring-tls.html#tls-ldap)。
- 1.有关加密Elastic Stack中的通信的详细信息，请参阅加密通信。

### 生成节点证书
- 1.可选:为您的Elasticsearch集群创建一个证书授权
>bin/elasticsearch-certutil ca

    [elk@localhost elasticsearch-7.1.1]$ bin/elasticsearch-certutil ca
    This tool assists you in the generation of X.509 certificates and certificate
    signing requests for use with SSL/TLS in the Elastic stack.
    
    The 'ca' mode generates a new 'certificate authority'
    This will create a new X.509 certificate and private key that can be used
    to sign certificate when running in 'cert' mode.
    
    Use the 'ca-dn' option if you wish to configure the 'distinguished name'
    of the certificate authority
    
    By default the 'ca' mode produces a single PKCS#12 output file which holds:
        * The CA certificate
        * The CA's private key
    
    If you elect to generate PEM format certificates (the -pem option), then the output will
    be a zip file containing individual files for the CA certificate and private key
    
    Please enter the desired output file [elastic-stack-ca.p12]: 
    Enter password for elastic-stack-ca.p12 :
    
- 2.为集群中的每个节点生成证书和私钥。
>bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12

    [elk@localhost elasticsearch-7.1.1]$ bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12
    This tool assists you in the generation of X.509 certificates and certificate
    signing requests for use with SSL/TLS in the Elastic stack.
    
    The 'cert' mode generates X.509 certificate and private keys.
        * By default, this generates a single certificate and key for use
           on a single instance.
        * The '-multiple' option will prompt you to enter details for multiple
           instances and will generate a certificate and key for each one
        * The '-in' option allows for the certificate generation to be automated by describing
           the details of each instance in a YAML file
    
        * An instance is any piece of the Elastic Stack that requires a SSL certificate.
          Depending on your configuration, Elasticsearch, Logstash, Kibana, and Beats
          may all require a certificate and private key.
        * The minimum required value for each instance is a name. This can simply be the
          hostname, which will be used as the Common Name of the certificate. A full
          distinguished name may also be used.
        * A filename value may be required for each instance. This is necessary when the
          name would result in an invalid file or directory name. The name provided here
          is used as the directory name (within the zip) and the prefix for the key and
          certificate files. The filename is required if you are prompted and the name
          is not displayed in the prompt.
        * IP addresses and DNS names are optional. Multiple values can be specified as a
          comma separated string. If no IP addresses or DNS names are provided, you may
          disable hostname verification in your SSL configuration.
    
        * All certificates generated by this tool will be signed by a certificate authority (CA).
        * The tool can automatically generate a new CA for you, or you can provide your own with the
             -ca or -ca-cert command line options.
    
    By default the 'cert' mode produces a single PKCS#12 output file which holds:
        * The instance certificate
        * The private key for the instance certificate
        * The CA certificate
    
    If you specify any of the following options:
        * -pem (PEM formatted output)
        * -keep-ca-key (retain generated CA key)
        * -multiple (generate multiple certificates)
        * -in (generate certificates from an input file)
    then the output will be be a zip file containing individual certificate/key files
    
    Enter password for CA (elastic-stack-ca.p12) : 
    Please enter the desired output file [elastic-certificates.p12]: 
    Enter password for elastic-certificates.p12 : 
    
    Certificates written to /home/elk/app/elasticsearch-7.1.1/elastic-certificates.p12
    
    This file should be properly secured as it contains the private key for 
    your instance.
    
    This file is a self contained file and can be copied and used 'as is'
    For each Elastic product that you wish to configure, you should copy
    this '.p12' file to the relevant configuration directory
    and then follow the SSL configuration instructions in the product guide.
    
    For client applications, you may only need to copy the CA certificate and
    configure the client to trust this certificate.
    
- 3.将节点证书复制到适当的位置。
## 加密群集编辑中节点之间的通信

启用TLS并指定访问节点证书所需的信息。

如果签名的证书是PKCS#12格式的，请将以下信息添加到elasticsearch中。每个节点上的elasticsearch.yml文件:

    xpack.security.transport.ssl.enabled: true
    xpack.security.transport.ssl.verification_mode: certificate 
    xpack.security.transport.ssl.keystore.path: certs/elastic-certificates.p12 
    xpack.security.transport.ssl.truststore.path: certs/elastic-certificates.p12 



## 加密HTTP客户机通信 【Encrypting HTTP Client communicationsedit】

启用TLS并指定访问节点证书所需的信息。

如果证书是PKCS#12格式的，请将以下信息添加到elasticsearch中。每个节点上的elasticsearch.yml文件:

    xpack.security.http.ssl.enabled: true
    xpack.security.http.ssl.keystore.path: certs/elastic-certificates.p12 
    xpack.security.http.ssl.truststore.path: certs/elastic-certificates.p12 

如果使用密码保护了节点的证书，请将密码添加到Elasticsearch密钥存储库
    
    bin/elasticsearch-keystore add xpack.security.http.ssl.keystore.secure_password
    bin/elasticsearch-keystore add xpack.security.http.ssl.truststore.secure_password
    